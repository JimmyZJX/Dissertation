%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\chapter{Higher-Ranked Polymorphism Subtyping Algorithm}
\label{chap:ITP}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

In this chapter, we present a new algorithm for polymorphic subtyping
with mechanical formalizations in the Abella theorem prover.
There is little work on formalizing type inference algorithms before,
especially for higher-ranked systems,
due to the fact that environments and variable bindings are
tricky to mechanize in theorem provers.
In order to overcome the difficulty in formalization,
we propose the novel algorithm by means of \emph{worklist judgments}.
Worklist judgments turn complicated
global propagation of unification constraints into simple local substitutions.
Moreover, we exploit several ideas in the recent inductive
formulation of a type-inference algorithm by
\citet{dunfield2013complete}, which turn out to be useful
for mechanization in a theorem prover.

Building on these ideas we develop a complete formalization of
polymorphic subtyping in the Abella theorem prover. Moreover, we
 show that the algorithm is \emph{sound}, \emph{complete}, and \emph{decidable} with
respect to the well-known declarative formulation of polymorphic subtyping by
\citet{odersky1996putting}.
While these meta-theoretical results are not new, as far
as we know our work is the first to mechanically formalize them.


\section{Overview: Polymorphic Subtyping}

% We hope that
% this work encourages other researchers to use theorem provers for formalizing
% type-inference algorithms.

\input{Sources/ITP/sec2.tex}
\input{Sources/ITP/sec3.tex}
\input{Sources/ITP/sec4.tex}

\input{Sources/ITP/abella.tex}

%Dunfield and Krishnaswami calculus tracks the (partial) solutions of existential variables
%in the algorithmic context; they denote a delayed substitution that is
%incrementally applied to outstanding work as it is encoutered.  
%Instead of reifying the substitution, our algorithm keeps track of an explicit list of
%outstanding work.


